<!DOCTYPE html>
<html>
    <head>
        <title>
            Kajate MES
        </title>
    </head>
    <body style="background-color: rgb(56, 184, 145);">
        <h1 style="margin-left: 45%"> Refslev Bryggeri A/S </h1>
        <p style="margin-left: 45%">Refslev Bryggeri er top kewl</p>
        <h3> Storsl√•ede bajere and hello world </h3>
        <form action="http://localhost:3000/form_data" method="post" target="_blank">
            <label for: "batchID">Batch ID:</label>
            <input name="tfBatchID" type="text" id="tfBatchID"><br>
            <label for: "productType">Product Type:</label>
            <input name="tfProductType" type="text" id="tfProductType"><br>
            <label for: "productAmount">Amount:</label>
            <input name="tfProductAmount" type="text" id="tfProductAmount"><br>
            <label for: "machineSpeed">Machine Speed:</label>
            <input name="tfMachineSpeed" type="text" id="tfMachineSpeed"><br>
            <input type="submit" id="btnStart" value="Start">    
            <!-- <input type="submit" value="Stop">
            <input type="submit" value="Reset">
            <input type="submit" value="Abort">
            <input type="submit" value="Clear"> -->
        </form>
        <ul> 
            <li>Batch id: <span id="spanBatchId"> 0 </span></li> 
            <li>Product type: <span id="spanProductId"> 0 </span> </li> 
            <li>Amount to produce: <span id="spanAmountId"> 0 </span></li> 
            <li>Machine speed: <span id="spanSpeedId"> 0 </span></li> 
            <li>Produced: <span id="spanProducedId"> 0 </span></li>
        </ul>

        <script>
           function poll(){
                fetch("http://localhost:3000/opcua_data")
                .then(response => response.json())
                .then(json => { 
                    document.getElementById("spanBatchId").innerText = document.getElementById("tfBatchID").value;
                    document.getElementById("spanProductId").innerText = document.getElementById("tfProductType").value;
                    document.getElementById("spanAmountId").innerText = document.getElementById("tfProductAmount").value;
                    document.getElementById("spanSpeedId").innerText = document.getElementById("tfMachineSpeed").value;
                    document.getElementById("spanProducedId").innerText = json.produced;
                })
                .then(() => setTimeout(poll(), 500))
                .catch(err => console.log(err));
           }

           document.getElementById("btnStart").addEventListener("click", () => {
                setTimeout(() => {
                    poll();
                }, 5000);
           });
        </script>

    </body>
</html>