<!DOCTYPE html>
<html>

<head>
    <title>Statistical Analysis</title>
    <link rel="stylesheet" href="stylesheets/variables.css">
    <link rel="stylesheet" href="stylesheets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
</head>

<body class="flexDirectionColumn">
    <!--TOP HEADER-->
    <header>
        <div class="wrapper flexDirectionRow flexSpaceEvenly flexWrap">
            <p id="dateTime" class="flexDirectionRow flexCenterSingleRow">12:45 30-10-2020</p>
            <div id="searchBar" class="flexDirectionRow flexRight flexSize1">
                <input class="defaultInput" type="text" placeholder="Search batch products...">
                <button class="flexDirectionRow flexCenterSingleRow"><img src="images/icons/search-icon.png"></button>
            </div>
        </div>
    </header>
    <div class="wrapper flexDirectionRow flexSize1 flexWrap">
        <!--SIDEBAR-->
        <aside class="flexSize1 flexDirectionColumn">
            <div class="flexDirectionRow flexCenterMultipleRows" id="logoContainer">
                <img src="./images/logo-web.png">
            </div>
            <nav>
                <ul>
                    <li><a href="./Index.html"><img src="images/icons/dashboard-icon.png">Dashboard</a></li>
                    <li><a href="./BatchReport.html"><img src="images/icons/batch-report-icon.png"> Batch reports</a>
                    </li>
                    <li><a href="./StatisticalAnalysis.html"><img
                                src="images/icons/statistical analysis-icon.png">Statistical Analysis</a></li>
                    <li><a href="./DatabaseContents.html"><img src="images/icons/database-icon.png">Database
                            Contents</a></li>
                    <li><a href="./CheckServers.html"><img src="images/icons/server-icon.png">Check Servers</a></li>
                </ul>
            </nav>
        </aside>
        <!--DASHBOARD BOXES-->
        <div class="flexSize2">
            <div class=" flexWrap flexSpaceEvenly">
                <!-- 
                    Two charts - hardcoded as line: produced over time, bar: totalProduced, defectiveProduced and acceptableProduced, 
                -->

                <h2 style="text-align: center;">Statistical analysis of productions</h2><br>
                <div style="padding-left: 40px;">
                    <form action="http://localhost:3000/search" method="post" target="_blank">
                        <label for="BatchId">Enter the Batch-ID for the production: </label><br><br>
                        <input type="number" id="BatchId" name="BatchId" style="padding-right: 20px;">
                        <input id="btnSubmit" type="submit" value="Submit" class="buttonDefault buttonSuccess">
                    </form>
                    <script>

                    </script>
                </div> <br>
                <div>
                    <h3 style="text-align: center;">Total, defect and acceptable products</h3>
                    <canvas id="productsChart" width="400" height="400"></canvas>
                </div>
                <div>
                    <h3 style="text-align: center;">Produced products over time</h3>
                    <canvas id="prodProcessedChart" width="400" height="400"></canvas>
                </div>
                <div>
                    <h3 style="text-align: center;">Time spent in different states</h3>
                    <canvas id="stateChart" width="400" height="400"></canvas>
                </div>
                <script>
                    let logData = 0;

                    //associate submit-button with a request to the DB
                    document.getElementById("btnSubmit").addEventListener("click",() => {
                        fetch("http://localhost:3000/search", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: '{"BatchId" : ' + document.getElementById("BatchId").value + '}'
                        })
                            .then(response => response.json())
                            .then(json => {
                                logData = json;
                                console.log(logData.Logs.Humidity);
                            });
                        });
                    
                    //bar chart
                    let data = [3, 5, 1]; //insert "data" variable here in the future
                    const ctx = document.getElementById('productsChart');
                    const myChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Produced', 'Defect Products', 'Acceptable products'],
                            datasets: [{
                                label: 'Amount of beer',
                                data: data,
                                backgroundColor: [
                                    'rgba(13, 255, 0, 0.5)',
                                    'rgba(242, 0, 255, 0.5)',
                                    'rgba(255, 0, 0, 0.5)',
                                    'rgba(255, 132, 0, 0.5)',
                                    'rgba(0, 183, 255, 0.5)',
                                    'rgba(47, 0, 255, 0.5)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }]
                            }
                        }
                    });

                    //line chart
                    let ddata = [/* Get "produced, "defective" and "acceptable" from certain batch in DB */];
                    const prodElem = document.getElementById('prodProcessedChart');
                    const lineChart = new Chart(prodElem, {
                        type: 'line',
                        data: {
                            labels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                            datasets: [{
                                label: "Totalt products over time",
                                data: [0, 2, 1, 6, 4, 5, 3, 1, 0], //insert "ddata" variable here in the future
                                backgroundColor: "rgba(13, 255, 0, 0.5)",
                                lineTension: 0.2
                            }]
                        },
                        options: {

                        }
                    });

                    //radar chart
                    let dddata = [/* Get log over machine states */];
                    const stateElem = document.getElementById("stateChart");
                    const stateChart = new Chart(stateElem, {
                        type: 'pie',
                        data: {
                            labels: ["Deactivated", "Clearing", "Stopped", "Starting", "Idle", "Suspended", "Execute", "Stopping", "Aborting", "Aborted", "Holding", "Held", "Resetting", "Completing", "Complete", "Deactivating", "Activating"],
                            datasets: [{
                                label: "Time spent in different machine states",
                                data: [100, 40, 30, 5, 45, 23, 90, 50, 30, 10, 5, 15, 60, 70, 5, 12, 51], //insert "dddata" variable here in the future
                                backgroundColor: [
                                    'rgba(255, 0, 0, 0.5)',
                                    'rgba(0, 255, 0, 0.5)',
                                    'rgba(0, 0, 255, 0.5)',
                                    'rgba(255, 255, 0, 0.5)',
                                    'rgba(0, 255, 255, 0.5)',
                                    'rgba(255, 0, 255, 0.5)',
                                    'rgba(125, 10, 125, 0.5)',
                                    'rgba(125, 0, 0, 0.5)',
                                    'rgba(0, 125, 0, 0.5)',
                                    'rgba(0, 0, 125, 0.5)',
                                    'rgba(120, 255, 54, 0.5)',
                                    'rgba(50, 0, 130, 0.5)',
                                    'rgba(125, 125, 0, 0.5)',
                                    'rgba(125, 0, 125, 0.5)',
                                    'rgba(0, 125, 125, 0.5)',
                                    'rgba(87, 255, 87, 0.5)',
                                    'rgba(255, 87, 87, 0.5)']
                            }]
                        },
                        options: {
                        }
                    });
                </script>
            </div>
        </div>
    </div>
    <!-- FOOTER -->
    <footer>
        <div class="wrapper flexCenterSingleRow flexSpaceEvenly">
            <p>Human Machine Interface developed by group 5: <br> Jonas Svane, Arem Dogan, Emma Johanne Bovtrup, Andreas
                Schmidt Tembjerg <br>
                Karthikan Vimalarasan, Wahid Tobias Winberg Razzaghi</p>
            <!-- SCRIPT -->

</body>

</html>